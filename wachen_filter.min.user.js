// ==UserScript==
// @name         Gebäude Übersicht_compressed
// @namespace    http://tampermonkey.net/
// @version      1.3.2
// @description  Eigene Konfiguration zum ein-/ausblenden von Gebäuden in der Gebäudeübersicht
// @author       Christian (LeitstelleHRO) / Jan (KBOE2)
// @grant        none
// @include      https://www.leitstellenspiel.de/
// ==/UserScript==

(function(){"use strict";function wachenFilter(){var i,e,l,t;if(!$("#customizeBuildingFilter")[0]){for($(".building_selection").each(function(){$(this).remove()}),e={script:[{ids:[0],name:"Feuerwehr"},{ids:[2],name:"Rettung"},{ids:[6],name:"Polizei"},{ids:[9],name:"THW"},{ids:[15],name:"Wasserrettung"},{ids:[1,3,8,10],name:"Schulen"},{ids:[7],name:"Leitstelle"},{ids:[5,12],name:"SEG/RTH"},{ids:[11],name:"Bepol"},{ids:[13,17],name:"PolHeli/Pol-Sonder"},{ids:[4],name:"Krankenhäuser"}],game:[{ids:[0],name:"Feuerwehr"},{ids:[2,4,5,12],name:"Rettung"},{ids:[6,11,13,17],name:"Polizei"},{ids:[9],name:"THW"},{ids:[15],name:"Wasserrettung"},{ids:[1,3,8,10],name:"Schulen"},{ids:[7],name:"Leitstelle"}]},localStorage.buildingListButtons?i=JSON.parse(localStorage.buildingListButtons):(i=e.script,localStorage.buildingListButtons=JSON.stringify(i)),l=["Feuerwache","Feuerwehrschule","Rettungswache","Rettungsschule","Krankenhaus","Rettungshubschrauber-Station","Polizeiwache","Leitstelle","Polizeischule","THW","THW Bundesschule","Bereitschaftspolizei","Schnelleinsatzgruppe (SEG)","Polizeihubschrauberstation","Bereitstellungsraum","Wasserrettung","Verbandzellen","Polizei-Sondereinheiten","Feuerwache (Kleinwache) => Geht leider derzeit nicht","Polizeiwache (Kleinwache) => Geht leider derzeit nicht","Rettungswache (Kleinwache) => Geht leider derzeit nicht","Rettungshundestaffel"],$("#building_panel_heading > .btn-group").append('<a class="btn btn-xs btn-default" id="customizeBuildingFilter">Gebäude-Filter anpassen</a>'),t=0;t<i.length;t++)$("#btn-group-building-select").append('<a building_type_ids="'+JSON.stringify(i[t].ids)+'" class="btn btn-xs btn-success building_selection" id="building_selection_'+i[t].name.replace(/ /g,"").toLowerCase()+'" title="Grün = Die Gebäude werden in der Leiste angezeigt. Rot = Die Gebäude werden nicht angezeigt.">'+i[t].name+"</a>");$(".building_selection").on("click",function(){var i,e,l,t;if($(this).hasClass("btn-success"))for($(this).removeClass("btn-success"),$(this).addClass("btn-danger"),i=0;i<JSON.parse($(this).attr("building_type_ids")).length;i++)for(e=0;e<$('.building_list_li[building_type_id="'+JSON.parse($(this).attr("building_type_ids"))[i]+'"]').length;e++)$($('.building_list_li[building_type_id="'+JSON.parse($(this).attr("building_type_ids"))[i]+'"]')[e]).hide();else for($(this).removeClass("btn-danger"),$(this).addClass("btn-success"),l=0;l<JSON.parse($(this).attr("building_type_ids")).length;l++)for(t=0;t<$('.building_list_li[building_type_id="'+JSON.parse($(this).attr("building_type_ids"))[l]+'"]').length;t++)$($('.building_list_li[building_type_id="'+JSON.parse($(this).attr("building_type_ids"))[l]+'"]')[t]).show()}),$(".building_selection").on("dblclick",function(){$(".building_list_li").each(function(){$(this).show()}),$('.building_selection[id!="'+$(this).attr("id")+'"]').each(function(){$(this).removeClass("btn-success"),$(this).addClass("btn-danger")}),$(this).removeClass("btn-danger"),$(this).addClass("btn-success");for(var i,e=0;e<$(".building_list_li").length;e++)i=$(".building_list_li")[e],-1==JSON.parse($(this).attr("building_type_ids")).indexOf(parseInt($(i).attr("building_type_id")))?$(i).hide():$(i).show()}),$("#customizeBuildingFilter").on("click",function(){var t,n,s,r,d,a,u,o,c='<div id="buildingFilterCustomizer" style="background: #fff; z-index: 10000; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); min-width: 200px; max-width: 600px; max-height: '+($(window).height()-20)+'px; width: 80%; border: 1px solid rgb(66, 66, 66); color: black; padding: 5px; overflow: auto; margin-top: 10px;"><button type="button" class="close buildingFilterCustomizerClose aria-label="Schliessen" style="margin: 5px;">×</button><div class="container-fluid"><h3>Gebäude-Filter anpassen</h3><hr><div class="row"><div class="col col-md-3"><button class="btn btn-success" id="newFilter"><i class="glyphicon glyphicon-plus"></i></button><label for="newFilter">&nbsp;Neuen Filter hinzufügen</label></div><div class="col col-md-3"><button class="btn btn-success" id="saveFilters"><i class="glyphicon glyphicon-floppy-disk"></i></button><label for="saveFilters">&nbsp;Filter speichern</label></div><div class="col col-md-3"><button class="btn btn-success" id="resetNormal"><i class="glyphicon glyphicon-floppy-remove"></i></button><label for="resetNormal">&nbsp;Auf Spiel-Standard zurücksetzen</label></div><div class="col col-md-3"><button class="btn btn-success" id="resetScript"><i class="glyphicon glyphicon-floppy-remove"></i></button><label for="resetScript">&nbsp;Auf Script-Standard zurücksetzen</label></div></div><hr><div id="filterConfigurations"></div></div></div>';for($("body").append(c),$(".buildingFilterCustomizerClose").click(function(){$("#buildingFilterCustomizer").remove()}),n=JSON.parse(localStorage.buildingListButtons),s=0;s<n.length;s++){for(t="",r=0;r<n[s].ids.length;r++)0!=r&&(t+=", "),t+=l[n[s].ids[r]];for(d='<div class="buildingFilter" style="float: left;"><div class="pullFilter"></div><div class="input-group string required"><div class="input-group-addon"><label class="string required " for="filter_name_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Name Filter '+$(".buildingFilter").length+'</label> <button class="btn btn-danger btn-xs deleteFilter"><i class="glyphicon glyphicon-trash"></i></button></div><input class="string required form-control" id="filter_name_'+$(".buildingFilter").length+'" name="filter_name_'+$(".buildingFilter").length+'" size="50" type="text" value="'+n[s].name+'"></div><div class="input-group string required"><div class="input-group-addon"><label class="string required " for="filter_ids_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Gebäudetypen Ausgewählt Filter '+$(".buildingFilter").length+'</label><input class="input required form-control disabled" id="filter_ids_'+$(".buildingFilter").length+'" name="filter_ids_'+$(".buildingFilter").length+'" disabled value="'+t+'"></input></div></div><div class="input-group select required"><div class="input-group-addon"><label class="select required " for="filter_id_selection_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Gebäudetypen-Auswahl Filter '+$(".buildingFilter").length+'</label><select multiple class="select required form-control filterIdSelection" id="filter_id_selection_'+$(".buildingFilter").length+'">',a=0;a<l.length;a++)d+="<option>"+l[a]+"</option>";for(d+="</select></div></div>",d+="</div>",$("#filterConfigurations").append(d),u=[],o=0;o<n[s].ids.length;o++)u[o]=[l[n[s].ids[o]]];$("#filter_id_selection_"+($(".buildingFilter").length-1)).val(u)}$(".filterIdSelection").on("change",function(){$($(this).parent().parent().parent().children()[2]).children().children()[1].value="";for(var i=0;i<$(this).val().length;i++)0!=i&&($($(this).parent().parent().parent().children()[2]).children().children()[1].value+=", "),$($(this).parent().parent().parent().children()[2]).children().children()[1].value+=$(this).val()[i]}),$("#newFilter").click(function(){var i,e,t,r;for(i='<div class="buildingFilter" style="float: left;"><div class="pullFilter"></div><div class="input-group string required"><div class="input-group-addon"><label class="string required " for="filter_name_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Name Filter '+$(".buildingFilter").length+'</label> <button class="btn btn-danger btn-xs deleteFilter"><i class="glyphicon glyphicon-trash"></i></button></div><input class="string required form-control" id="filter_name_'+$(".buildingFilter").length+'" name="filter_name_'+$(".buildingFilter").length+'" size="50" type="text"></div><div class="input-group string required"><div class="input-group-addon"><label class="string required " for="filter_ids_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Gebäudetypen Ausgewählt Filter '+$(".buildingFilter").length+'</label><input class="input required form-control disabled" id="filter_ids_'+$(".buildingFilter").length+'" name="filter_ids_'+$(".buildingFilter").length+'" disabled></input></div></div><div class="input-group select required"><div class="input-group-addon"><label class="select required " for="filter_id_selection_'+$(".buildingFilter").length+'"><abbr title="required">*</abbr> Gebäudetypen-Auswahl Filter '+$(".buildingFilter").length+'</label><select multiple class="select required form-control filterIdSelection" id="filter_id_selection_'+$(".buildingFilter").length+'">',e=0;e<l.length;e++)i+="<option>"+l[e]+"</option>";for(i+="</select></div></div>",i+="</div>",$("#filterConfigurations").append(i),t=[],r=0;r<n[s].ids.length;r++)t[r]=[l[n[s].ids[r]]];$("#filter_id_selection_"+($(".buildingFilter").length-1)).val(t)}),$("#saveFilters").click(function(){var i,e,t,n,s;for(i=[],e=0;e<$(".filterIdSelection").length;e++){for(t=$($(".filterIdSelection")[e]).val(),n=[],s=0;s<t.length;s++)n[s]=l.indexOf(t[s]);i[e]={},i[e].ids=n,i[e].name=$($($(".filterIdSelection")[e]).parent().parent().parent().children()[1]).children()[1].value}localStorage.buildingListButtons=JSON.stringify(i),alert("Die Filter wurden erfolgreich gespeichert.\nDu musst das Spiel neu laden, um die Änderungen zu übernehmen!")}),$(".deleteFilter").click(function(){1==$(".buildingFilter").length?alert("Du kannst den letzten verbleibenden Button nicht löschen!"):$(this).parent().parent().parent().remove()}),$("#resetNormal").click(function(){i=e.game,localStorage.buildingListButtons=JSON.stringify(i),location.reload()}),$("#resetScript").click(function(){i=e.script,localStorage.buildingListButtons=JSON.stringify(i),location.reload()}),$("#filterConfigurations").sortable({placeHolder:"sort-highlight",handle:".pullFilter",forcePlaceholderSize:!0,zIndex:999999}),$(".pullFilter").css("cursor","move"),$(".pullFilter").css("border","1px solid rgba(33, 37, 37, 0.1)"),$(".pullFilter").css("background-color","rgba(33, 37, 37, 0.1)"),$(".pullFilter").css("height","10px"),$(".pullFilter").css("border-radius","8px"),$(".buildingFilter").css("border","1px solid black"),$(".buildingFilter").css("border-radius","8px"),$(".buildingFilter").css("margin-bottom","2px"),$(".buildingFilter").css("padding","2px")}),$(".building_list_li").each(function(){$(this).show()})}}$("head").append('<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"><\/script>'),wachenFilter(),buildingLoadContent,buildingLoadContent=function(url){$("#buildings").html(I18n.t("common.loading")),buildingResetContentPossible=!1,building_eval_unload&&(eval(building_eval_unload),building_eval_unload=null),$.ajax({url,cache:!1}).success(function(i){$("#buildings").html(i),bigMapWindowSizeChanged(),"/buildings"==url&&wachenFilter()})},$("#buildings_outer").hover(function(){wachenFilter()})})();
